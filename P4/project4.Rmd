Wine quality exploration by Ger Inberg
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(gridExtra)
```

```{r Load_the_Data}
# Load the Data, combine the two datasets and print some basics
redwine <-read.csv("data/wineQualityReds.csv", header=TRUE, sep = ",") 
whitewine <-read.csv("data/wineQualityWhites.csv", header=TRUE, sep = ",") 
redwine$color = 'red'
whitewine$color = 'white'
wine <- rbind(redwine, whitewine)
wine$color = factor(wine$color)
wine$total.acidity = wine$fixed.acidity + wine$volatile.acidity
wine$alcohol_level <- cut(wine$alcohol, 
 breaks = c(quantile(wine$alcohol, prob =   0), quantile(wine$alcohol, prob = .33), 
            quantile(wine$alcohol, prob = .66), quantile(wine$alcohol, prob =   1)),
 labels = c("Low", "Medium", "High"))
wine$quality_level <- cut(wine$quality, 
 breaks = c(quantile(wine$quality, prob =   0), quantile(wine$quality, prob = .33), 
            quantile(wine$quality, prob = .66), quantile(wine$quality, prob =   1)),
 labels = c("Low", "Medium", "High"))

dim(wine)
summary(wine)
str(wine)
```

# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}

sup = function(plot){
  suppressMessages(print(plot))  
}

#plot histograms

#fixed.acidity
sup(ggplot(data = wine, aes(x=fixed.acidity)) + geom_histogram())
#volatile.acidity
sup(ggplot(data = wine, aes(x=volatile.acidity)) + geom_histogram())
#total.acidity
sup(ggplot(data = wine, aes(x=total.acidity)) + geom_histogram())
#citric.acid
sup(ggplot(data = wine, aes(x=citric.acid)) + geom_histogram())
#residual.sugar
sup(ggplot(data = wine, aes(x=residual.sugar)) + geom_histogram())
#chlorides
sup(ggplot(data = wine, aes(x=chlorides)) + geom_histogram())
#free.sulfur.dioxide
sup(ggplot(data = wine, aes(x=free.sulfur.dioxide)) + geom_histogram())
#total.sulfur.dioxide
sup(ggplot(data = wine, aes(x=total.sulfur.dioxide)) + geom_histogram())
#density
sup(ggplot(data = wine, aes(x=density)) + geom_histogram())
#pH
sup(ggplot(data = wine, aes(x=pH)) + geom_histogram())
#sulphates
sup(ggplot(data = wine, aes(x=sulphates)) + geom_histogram())
#alcohol
sup(ggplot(data = wine, aes(x=alcohol)) + geom_histogram())
#color
sup(ggplot(data = wine, aes(x=color)) + geom_histogram())

#quality
sup(ggplot(data = wine, aes(x=quality)) + geom_bar(binwidth=1))
```

# Univariate Analysis

### What is the structure of your dataset?

There are 1599 wines in the dataset with 13 features (fixed.acidity, volatile.acidity, citric.acid, residual.sugar, chlorides, free.sulfur.dioxide, total.sulfur.dioxide, density, pH, sulphates, alcohol, color and quality). The (output) variable quality is an integer, the color is a factor variable while the others are numbers.

Some other observations:
The density of wine is close to 1, so equals the density of water.
The median quality for a redwine is 6 and the max is 8.
There are a lot more observations for white wine compared to red wine.

### What is/are the main feature(s) of interest in your dataset?

The main feature in the data set is quality. Iâ€™d like to determine which features are best for predicting the quality of a red wine. I suspect a combination of the other variables can be used to build a predictive model to determine the quality.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

I think all of the other features, except density, can have an impact on the quality of the wine. Acidity and Alcohol could be major factors, because too much or less of these can make the wine unbalanced. 

### Did you create any new variables from existing variables in the dataset?

I have created a variable total.acidity, which is the sum of fixed.acidity and volatile.acidity. 
I have also created alcohol_level and quality_level variable to be able to use them as a factor in the plots.

### Of the features you investigated, were theres any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

Most features that I plotted have a 'normalish' distribution, i.e. they have a pattern that looks like a normal distribution. This means that most of the values are of that feature are close to the mean and median count.
The plot of the residual.sugar however is different: it starts at a value of zero with the highest count and after that it only decreases. It looks like the right side of a normal distribution. 

# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}

#scatterplots for 2 variables
wineQualityLow <- range(wine$quality)[1]
wineQualityHigh <- range(wine$quality)[2]

#fixed.acidity
ggplot(data = wine, aes(x=fixed.acidity, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#volatile.acidity
ggplot(data = wine, aes(x=volatile.acidity, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#total.acidity
ggplot(data = wine, aes(x=total.acidity, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#citric.acid
ggplot(data = wine, aes(x=citric.acid, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#residual.sugar
ggplot(data = wine, aes(x=residual.sugar, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#chlorides
ggplot(data = wine, aes(x=chlorides, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#free.sulfur.dioxide
ggplot(data = wine, aes(x=free.sulfur.dioxide, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#total.sulfur.dioxide
ggplot(data = wine, aes(x=total.sulfur.dioxide, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#density
ggplot(data = wine, aes(x=density, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#pH
ggplot(data = wine, aes(x=pH, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#sulphates
ggplot(data = wine, aes(x=sulphates, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#alcohol
ggplot(data = wine, aes(x=alcohol, y=quality)) + geom_point() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
#color
ggplot(data = wine, aes(x=color, y=quality)) + geom_boxplot() + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))

#pH vs citric.acid
ggplot(data = wine, aes(x=citric.acid, y=pH)) + geom_point() + xlim(0,0.75) + ylim(2.5, 3.75) + stat_smooth(method = "lm", col='red')

#total.sulfur.dioxide vs free.sulfur.dioxide
ggplot(data = wine, aes(x=free.sulfur.dioxide, y=total.sulfur.dioxide)) + geom_point() +xlim(0,100) + ylim(0,250) + stat_smooth(method = "lm", col='red')
```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

I have made plots of the quality feature versus the other features. Most of the features don't seem to have a big impact on the quality because at most values of the input feature, most quality values are present. 
For the features sulphates and chlorides there seems to be a negative trend, i.e. the quality decreases with a higer value for the input feature. Alcohol, on the other end, seems to have a positive trend.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

I have looked at other relations between features and there seems to be a relationship between pH and citric.acid. When reading about acidity and ph levels, there is a logical explanation for this. The pH level of citric acid is 2.2 while wines mostly have a pH level between 2.9 and 3.9. So when more citric.acid, the pH level of the wine will drop.

### What was the strongest relationship you found?

The strongst relationship that I found is between the total.sulfur.dioxide and free.sulfur.dioxide. This is explainable, because according to the documentation the total sulfur dioxide includes the amount of free forms of SO2 (=free.sulfur.dioxide).

# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}
#plots with 3 variables

#alcohol vs sulphates, color by quality_level
ggplot(data = wine, aes(x=sulphates, y=alcohol, color=quality_level)) + geom_point() 

#alcohol vs chlorides, color by quality_level
ggplot(data = wine, aes(x=chlorides, y=alcohol, color=quality_level)) + geom_point() 

#sulphates vs chlorides, color by quality_level
ggplot(data = wine, aes(x=chlorides, y=sulphates, color=quality_level)) + geom_point() 

#quality vs total.acidity, color by color 
ggplot(data = wine, aes(x=total.acidity, y=quality, color=color)) + geom_point(alpha=1/5) + scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1))
mean(wine[wine$color %in% 'red',]$total.acidity)
mean(wine[wine$color %in% 'white',]$total.acidity)

#total.sulfur.dioxide vs free.sulfur.dioxide, color by quality_level
ggplot(data = wine, aes(x=free.sulfur.dioxide, y=total.sulfur.dioxide, color=quality_level)) + geom_point() 
```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

When looking at the first 3 plots, it seems like alcohol, sulphates and chlorides strengthened each other. The blue dots that stand for high quality wines are more dominant in the upper left corner (first 2 plots) or lower left corner (3rd plot). 


### Were there any interesting or surprising interactions between features?

When comparing differences between wine color, I found some interesting differences. The total acidity is for red wines quite higher than for white wines.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
#price
ggplot(data = wine) + geom_histogram(aes(x=quality, y=..density..), binwidth=1, colour="black", fill="white") + 
  stat_function(fun = dnorm, args = list(mean = mean(wine$quality), sd = sd(wine$quality)), lwd = 2, col = 'red') +
  scale_x_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1), limits=c(3, 9)) +
  xlab('Quality') + ylab('Wine density') +
  ggtitle("Wine quality density and normal distribution")
```

### Description One

I have plotted the density of the quality of wines in a histogram plot. The histogram is overlapped with a normal distribution, that uses the mean and standard deviation from the quality variable. As can be seen, the histogram 'follows' the normal distribution quite well, it is a bit more shifted to the right.

### Plot Two
```{r echo=FALSE, Plot_Two}
#alcohol vs chlorides, color by quality_level
ggplot(data = wine, aes(x=chlorides, y=alcohol, color=quality_level)) + geom_point() + 
  scale_x_continuous(breaks = seq(0,0.2,0.05), limits=c(0,0.2)) + 
  scale_y_continuous(breaks = seq(8,14,2), limits=c(8,14)) + 
  xlab('chlorides (g / dm^3)') + ylab('alcohol (% per volume)') +
  ggtitle("Alcohol % vs chlorides colored by quality_level")
```

### Description Two

I have plotted the alcohol of wines vs the chlorides and coloured it by the quality_level. The highest quality wines (with color blue) are mostly located at the upper left corner of the plot. This means that a high alcohol percentage and a low chlorides value are indicators for a high quality wine.

### Plot Three
```{r echo=FALSE, Plot_Three}
#alcohol
ggplot(data = wine, aes(x=alcohol, y=quality)) + geom_point(alpha=1/2) + 
  stat_smooth(method = "lm", col='red') +
  scale_y_continuous(breaks = seq(wineQualityLow, wineQualityHigh, 1)) +   scale_x_continuous(breaks = seq(8, 14, 1), limits=c(8,14)) +
  xlab('alcohol (% by volume)') + ylab('quality') +
  facet_wrap( ~ color) +
  ggtitle("Quality vs alcohol faceted by wine color")
lm(quality ~ alcohol, data = redwine)
lm(quality ~ alcohol, data = whitewine)
```

### Description Three

I have plotted the quality of wine vs the alcohol percentage and facetted this by the wine color. Also, added a line representing the lineair model. As can be seen, the plots for red and white wine look quite similair. There seems to be a positive correlation between alcohol and quality, independent of the color. The lineair model line for red wines is a little bit steeper compared to the white wine plot.

# Reflection

The (combined) wine data set contains information on almost 6500 wines. I decided to add the red and wine datasets, because I was interested to see if the color of wine is a major factor in the quality of wine. In the boxplot of wine quality vs color, it can be seen that the quantiles are equal so color is not a major factor.
In the final plots, I have tried to visualize some interesting insights from the data. The quality histogram (plot1) follows almost a normal distribution, so most wines in the dataset are close to the mean and median value.
